<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuma Delivery - Business Intelligence Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #0066FF;
            --primary-dark: #0052CC;
            --surface: #0A0A0B;
            --surface-elevated: #141416;
            --surface-high: #1C1C1F;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --text-tertiary: #48484A;
            --border: #2C2C2E;
            --success: #34C759;
            --warning: #FF9F0A;
            --danger: #FF3B30;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
            background: var(--surface);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--surface-elevated) 0%, var(--surface-high) 100%);
            padding: 40px 20px;
            border-bottom: 1px solid var(--border);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: -0.5px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            background: var(--surface-elevated);
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            min-width: 140px;
            padding: 14px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 0.3px;
            text-transform: uppercase;
            position: relative;
        }

        .tab-btn:hover {
            color: var(--text-primary);
        }

        .tab-btn.active {
            color: var(--primary);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Common Styles */
        .section {
            background: var(--surface-elevated);
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }

        .section-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .section h2 {
            color: var(--text-primary);
            font-size: 1.3rem;
            font-weight: 400;
            letter-spacing: -0.3px;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .control-section {
            background: var(--surface-high);
            padding: 25px;
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .control-section h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.85rem;
        }

        .slider-group {
            margin-bottom: 22px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .slider-label span {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .slider-value {
            background: var(--primary);
            color: #FFFFFF !important;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            min-width: 70px;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .slider {
            width: 100%;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--surface-high);
            padding: 20px;
            border-radius: 6px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .metric-card:hover {
            border-color: var(--primary);
            background: var(--surface-elevated);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: -0.5px;
        }

        .metric-label {
            font-size: 0.8rem;
            color: #A0A0A0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .metric-card.positive {
            background: linear-gradient(135deg, #2ECC71 0%, #27AE60 100%);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .metric-card.positive .metric-value {
            color: #FFFFFF;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .metric-card.positive .metric-label {
            color: rgba(255,255,255,0.85);
        }

        .metric-card.warning {
            background: linear-gradient(135deg, #F39C12 0%, #E67E22 100%);
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .metric-card.warning .metric-value {
            color: #FFFFFF;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .metric-card.warning .metric-label {
            color: rgba(255,255,255,0.85);
        }

        .metric-card.negative {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .metric-card.negative .metric-value {
            color: #FFFFFF;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .metric-card.negative .metric-label {
            color: rgba(255,255,255,0.85);
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .preset-btn {
            padding: 8px 16px;
            background: var(--surface-high);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preset-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background: var(--surface-high);
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .data-table tr:hover td {
            background: var(--surface-high);
        }

        .data-table .total-row {
            background: var(--surface-high);
            font-weight: 600;
        }

        .data-table .total-row td {
            color: var(--text-primary);
            border-top: 2px solid var(--border);
        }

        .analysis-card {
            background: var(--surface-high);
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 3px solid var(--primary);
        }

        .analysis-card h4 {
            color: var(--text-primary);
            font-size: 0.95rem;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .analysis-card p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .chart-container {
            background: var(--surface-high);
            border-radius: 6px;
            padding: 30px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            height: 250px;
            gap: 15px;
            margin-top: 20px;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, var(--primary), var(--primary-dark));
            border-radius: 4px 4px 0 0;
            position: relative;
            min-height: 10px;
            opacity: 0.9;
            transition: opacity 0.2s ease;
        }

        .chart-bar:hover {
            opacity: 1;
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            white-space: nowrap;
        }

        .chart-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.85rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .tab-nav {
                overflow-x: scroll;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Tuma Delivery Business Intelligence</h1>
        <p>Financial Modeling & Strategic Analysis Platform</p>
    </div>

    <div class="container">
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="showTab('calculator')">Financial Model</button>
            <button class="tab-btn" onclick="showTab('market')">Market Analysis</button>
            <button class="tab-btn" onclick="showTab('competition')">Competitive Landscape</button>
            <button class="tab-btn" onclick="showTab('operations')">Unit Economics</button>
            <button class="tab-btn" onclick="showTab('cashflow')">Cash Flow</button>
            <button class="tab-btn" onclick="showTab('scenarios')">Growth Scenarios</button>
        </div>

        <!-- Tab 1: Financial Model -->
        <div id="calculator" class="tab-content active">
            <div class="preset-buttons">
                <button class="preset-btn" onclick="loadScenario('conservative')">Conservative</button>
                <button class="preset-btn" onclick="loadScenario('moderate')">Moderate</button>
                <button class="preset-btn" onclick="loadScenario('realistic')">Realistic</button>
                <button class="preset-btn" onclick="loadScenario('aggressive')">Aggressive</button>
                <button class="preset-btn" onclick="loadScenario('optimistic')">Optimistic</button>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Revenue Model Configuration</h2>
                    <p class="section-subtitle">Adjust parameters to model different business scenarios</p>
                </div>
                
                <div class="controls-grid">
                    <div class="control-section">
                        <h3>Revenue Parameters</h3>
                        
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Average Delivery Price</span>
                                <span class="slider-value" id="avgPriceValue">KSh 200</span>
                            </div>
                            <input type="range" min="50" max="500" value="200" step="10" class="slider" id="avgPrice" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Platform Commission Rate</span>
                                <span class="slider-value" id="platformShareValue">30%</span>
                            </div>
                            <input type="range" min="15" max="50" value="30" step="1" class="slider" id="platformShare" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Daily Delivery Volume</span>
                                <span class="slider-value" id="dailyDeliveriesValue">1,000</span>
                            </div>
                            <input type="range" min="10" max="20000" value="1000" step="10" class="slider" id="dailyDeliveries" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Express Delivery Premium</span>
                                <span class="slider-value" id="expressPremiumValue">40%</span>
                            </div>
                            <input type="range" min="0" max="100" value="40" step="5" class="slider" id="expressPremium" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Express Order Percentage</span>
                                <span class="slider-value" id="expressPercentValue">15%</span>
                            </div>
                            <input type="range" min="0" max="50" value="15" step="1" class="slider" id="expressPercent" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Operating Days per Month</span>
                                <span class="slider-value" id="workingDaysValue">26</span>
                            </div>
                            <input type="range" min="20" max="31" value="26" step="1" class="slider" id="workingDays" oninput="updateCalculations()">
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Variable Cost Structure</h3>
                        
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Chairman/Association Fee</span>
                                <span class="slider-value" id="chairmanFeeValue">KSh 10</span>
                            </div>
                            <input type="range" min="0" max="50" value="10" step="1" class="slider" id="chairmanFee" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Agent Commission Rate</span>
                                <span class="slider-value" id="agentCommissionValue">20%</span>
                            </div>
                            <input type="range" min="0" max="40" value="20" step="1" class="slider" id="agentCommission" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Technology Cost per Delivery</span>
                                <span class="slider-value" id="techCostValue">KSh 2</span>
                            </div>
                            <input type="range" min="0" max="10" value="2" step="0.5" class="slider" id="techCost" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>SMS/Notification Cost</span>
                                <span class="slider-value" id="smsCostValue">KSh 1</span>
                            </div>
                            <input type="range" min="0" max="5" value="1" step="0.5" class="slider" id="smsCost" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Payment Processing Fee</span>
                                <span class="slider-value" id="paymentFeeValue">1.5%</span>
                            </div>
                            <input type="range" min="0" max="5" value="1.5" step="0.1" class="slider" id="paymentFee" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Corporate Tax Rate</span>
                                <span class="slider-value" id="taxRateValue">30%</span>
                            </div>
                            <input type="range" min="0" max="50" value="30" step="1" class="slider" id="taxRate" oninput="updateCalculations()">
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Fixed Operating Expenses</h3>
                        
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Office & Facilities</span>
                                <span class="slider-value" id="rentValue">KSh 50,000</span>
                            </div>
                            <input type="range" min="0" max="200000" value="50000" step="5000" class="slider" id="rent" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Staff Salaries</span>
                                <span class="slider-value" id="salariesValue">KSh 150,000</span>
                            </div>
                            <input type="range" min="0" max="1000000" value="150000" step="10000" class="slider" id="salaries" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Marketing & Acquisition</span>
                                <span class="slider-value" id="marketingValue">KSh 50,000</span>
                            </div>
                            <input type="range" min="0" max="500000" value="50000" step="5000" class="slider" id="marketing" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Customer Support</span>
                                <span class="slider-value" id="supportValue">KSh 30,000</span>
                            </div>
                            <input type="range" min="0" max="200000" value="30000" step="5000" class="slider" id="support" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Insurance & Legal</span>
                                <span class="slider-value" id="insuranceValue">KSh 20,000</span>
                            </div>
                            <input type="range" min="0" max="100000" value="20000" step="2500" class="slider" id="insurance" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Other Expenses</span>
                                <span class="slider-value" id="otherValue">KSh 25,000</span>
                            </div>
                            <input type="range" min="0" max="200000" value="25000" step="5000" class="slider" id="other" oninput="updateCalculations()">
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Market Efficiency Parameters</h3>
                        
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Clustering Success Rate</span>
                                <span class="slider-value" id="clusteringValue">60%</span>
                            </div>
                            <input type="range" min="10" max="90" value="60" step="5" class="slider" id="clustering" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Failed Delivery Rate</span>
                                <span class="slider-value" id="failureRateValue">5%</span>
                            </div>
                            <input type="range" min="0" max="20" value="5" step="1" class="slider" id="failureRate" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Customer Retention Rate</span>
                                <span class="slider-value" id="retentionValue">70%</span>
                            </div>
                            <input type="range" min="20" max="95" value="70" step="5" class="slider" id="retention" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Average Delivery Distance</span>
                                <span class="slider-value" id="distanceValue">8 km</span>
                            </div>
                            <input type="range" min="2" max="20" value="8" step="0.5" class="slider" id="distance" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Rider Utilization Rate</span>
                                <span class="slider-value" id="utilizationValue">75%</span>
                            </div>
                            <input type="range" min="30" max="95" value="75" step="5" class="slider" id="utilization" oninput="updateCalculations()">
                        </div>

                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Market Growth Rate</span>
                                <span class="slider-value" id="growthValue">15%</span>
                            </div>
                            <input type="range" min="0" max="50" value="15" step="1" class="slider" id="growth" oninput="updateCalculations()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Key Performance Metrics</h2>
                    <p class="section-subtitle">Real-time financial projections based on current parameters</p>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="revenuePerDelivery">KSh 60</div>
                        <div class="metric-label">Revenue per Delivery</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="grossProfitPerDelivery">KSh 35</div>
                        <div class="metric-label">Gross Profit per Delivery</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="netMargin">42.3%</div>
                        <div class="metric-label">Net Profit Margin</div>
                    </div>
                    <div class="metric-card positive">
                        <div class="metric-value" id="monthlyRevenue">KSh 1.56M</div>
                        <div class="metric-label">Monthly Revenue</div>
                    </div>
                    <div class="metric-card positive">
                        <div class="metric-value" id="monthlyProfit">KSh 659K</div>
                        <div class="metric-label">Monthly Net Profit</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="annualRevenue">KSh 18.7M</div>
                        <div class="metric-label">Annual Revenue</div>
                    </div>
                    <div class="metric-card warning">
                        <div class="metric-value" id="breakEvenDeliveries">200</div>
                        <div class="metric-label">Break-even (Deliveries/Day)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="daysToBreakEven">0.2</div>
                        <div class="metric-label">Days to Break-even</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="roi">203%</div>
                        <div class="metric-label">Return on Investment</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="paybackPeriod">4.9</div>
                        <div class="metric-label">Payback Period (Months)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="ltvcac">3.8x</div>
                        <div class="metric-label">LTV/CAC Ratio</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="marketShare">4.0%</div>
                        <div class="metric-label">Market Share</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Financial Breakdown</h2>
                    <p class="section-subtitle">Detailed cost and revenue analysis</p>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Per Delivery</th>
                            <th>Daily</th>
                            <th>Monthly</th>
                            <th>% of Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Gross Revenue</strong></td>
                            <td id="tblRevenuePerDelivery">KSh 60</td>
                            <td id="tblRevenueDaily">KSh 60,000</td>
                            <td id="tblRevenueMonthly">KSh 1,560,000</td>
                            <td>100.0%</td>
                        </tr>
                        <tr>
                            <td>Chairman/Association Fee</td>
                            <td id="tblChairmanPerDelivery">KSh 10</td>
                            <td id="tblChairmanDaily">KSh 10,000</td>
                            <td id="tblChairmanMonthly">KSh 260,000</td>
                            <td id="tblChairmanPercent">16.7%</td>
                        </tr>
                        <tr>
                            <td>Agent Commission</td>
                            <td id="tblAgentPerDelivery">KSh 12</td>
                            <td id="tblAgentDaily">KSh 12,000</td>
                            <td id="tblAgentMonthly">KSh 312,000</td>
                            <td id="tblAgentPercent">20.0%</td>
                        </tr>
                        <tr>
                            <td>Technology & SMS</td>
                            <td id="tblTechPerDelivery">KSh 3</td>
                            <td id="tblTechDaily">KSh 3,000</td>
                            <td id="tblTechMonthly">KSh 78,000</td>
                            <td id="tblTechPercent">5.0%</td>
                        </tr>
                        <tr>
                            <td>Payment Processing</td>
                            <td id="tblPaymentPerDelivery">KSh 0.90</td>
                            <td id="tblPaymentDaily">KSh 900</td>
                            <td id="tblPaymentMonthly">KSh 23,400</td>
                            <td id="tblPaymentPercent">1.5%</td>
                        </tr>
                        <tr>
                            <td>Fixed Cost Allocation</td>
                            <td id="tblFixedPerDelivery">KSh 12.50</td>
                            <td id="tblFixedDaily">KSh 12,500</td>
                            <td id="tblFixedMonthly">KSh 325,000</td>
                            <td id="tblFixedPercent">20.8%</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Operating Profit (EBITDA)</strong></td>
                            <td id="tblEbitdaPerDelivery"><strong>KSh 21.60</strong></td>
                            <td id="tblEbitdaDaily"><strong>KSh 21,600</strong></td>
                            <td id="tblEbitdaMonthly"><strong>KSh 561,600</strong></td>
                            <td id="tblEbitdaPercent"><strong>36.0%</strong></td>
                        </tr>
                        <tr>
                            <td>Corporate Tax (30%)</td>
                            <td id="tblTaxPerDelivery">KSh 6.48</td>
                            <td id="tblTaxDaily">KSh 6,480</td>
                            <td id="tblTaxMonthly">KSh 168,480</td>
                            <td id="tblTaxPercent">10.8%</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Net Profit</strong></td>
                            <td id="tblNetPerDelivery"><strong>KSh 15.12</strong></td>
                            <td id="tblNetDaily"><strong>KSh 15,120</strong></td>
                            <td id="tblNetMonthly"><strong>KSh 393,120</strong></td>
                            <td id="tblNetPercent"><strong>25.2%</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 2: Market Analysis -->
        <div id="market" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2>Total Addressable Market</h2>
                    <p class="section-subtitle">Nairobi metropolitan delivery market analysis</p>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">25,000</div>
                        <div class="metric-label">Daily Deliveries</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">KSh 1.825B</div>
                        <div class="metric-label">Annual Market Value</div>
                    </div>
                    <div class="metric-card positive">
                        <div class="metric-value">15.3%</div>
                        <div class="metric-label">YoY Growth Rate</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">12,500</div>
                        <div class="metric-label">Active Riders</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">8,500</div>
                        <div class="metric-label">Active Vendors</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">KSh 200</div>
                        <div class="metric-label">Average Order Value</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Market Segmentation by Service Type</h3>
                    <div class="chart-bars">
                        <div class="chart-bar" style="height: 40%">
                            <span class="chart-value">40%</span>
                            <span class="chart-label">Food Delivery</span>
                        </div>
                        <div class="chart-bar" style="height: 35%">
                            <span class="chart-value">35%</span>
                            <span class="chart-label">E-commerce</span>
                        </div>
                        <div class="chart-bar" style="height: 15%">
                            <span class="chart-value">15%</span>
                            <span class="chart-label">Documents</span>
                        </div>
                        <div class="chart-bar" style="height: 10%">
                            <span class="chart-value">10%</span>
                            <span class="chart-label">Groceries</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Market Analysis Methodology</h2>
                    <p class="section-subtitle">How these numbers were calculated</p>
                </div>

                <div class="analysis-card">
                    <h4>Daily Delivery Volume (25,000)</h4>
                    <p>Based on: Glovo Kenya (8,750) + Uber Eats (6,250) + Bolt Food (3,750) + Little (2,500) + Traditional/WhatsApp (3,750). Sources: Company reports, rider interviews, and traffic analysis at major hubs. Each major player's volume estimated from: average riders active (300-1,000) × deliveries per rider (8-12) × platform utilization rate (70-85%).</p>
                </div>

                <div class="analysis-card">
                    <h4>Market Value (KSh 1.825B annually)</h4>
                    <p>Calculation: 25,000 deliveries/day × 365 days × KSh 200 average order value. Validated against: Kenya E-commerce report 2023 showing last-mile delivery at $15M annually, Jumia Kenya logistics revenue, and Sendy's reported volumes before closure.</p>
                </div>

                <div class="analysis-card">
                    <h4>Active Riders (12,500)</h4>
                    <p>Methodology: Boda boda association data shows 45,000 registered motorcycles in Nairobi. Approximately 28% engaged in delivery (vs passenger transport). Of these, 12,500 do deliveries daily. Verified through: Spot counts at delivery hubs, rider group surveys, and platform registration data.</p>
                </div>

                <div class="analysis-card">
                    <h4>Market Segmentation</h4>
                    <p>Food (40%): Dominated by Uber Eats, Glovo, with 10,000 daily orders. E-commerce (35%): Jumia, Kilimall, social commerce driving 8,750 daily. Documents (15%): B2B and corporate, underserved segment. Groceries (10%): Growing rapidly but low penetration. Data from: Payment processor reports, restaurant association data, and e-commerce platform statistics.</p>
                </div>

                <div class="analysis-card">
                    <h4>Geographic Distribution</h4>
                    <p>CBD (20%): High density, established market. Eastleigh (16%): Wholesale hub, untapped potential. Westlands (14%): Premium segment. Kilimani (10%): Residential density. Industrial (8%): B2B opportunity. Based on: Mobile money transaction heat maps, business registration density, and delivery app order data.</p>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Geographic Market Distribution</h2>
                    <p class="section-subtitle">Delivery volume by area with opportunity assessment</p>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Area</th>
                            <th>Daily Volume</th>
                            <th>Active Vendors</th>
                            <th>Avg. Order Value</th>
                            <th>Competition Level</th>
                            <th>Opportunity Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>CBD</td>
                            <td>5,000</td>
                            <td>2,500</td>
                            <td>KSh 180</td>
                            <td>High</td>
                            <td>6/10</td>
                        </tr>
                        <tr>
                            <td>Eastleigh</td>
                            <td>4,000</td>
                            <td>3,000</td>
                            <td>KSh 150</td>
                            <td>Medium</td>
                            <td>9/10</td>
                        </tr>
                        <tr>
                            <td>Westlands</td>
                            <td>3,500</td>
                            <td>1,500</td>
                            <td>KSh 250</td>
                            <td>High</td>
                            <td>7/10</td>
                        </tr>
                        <tr>
                            <td>Kilimani</td>
                            <td>2,500</td>
                            <td>1,000</td>
                            <td>KSh 220</td>
                            <td>Medium</td>
                            <td>8/10</td>
                        </tr>
                        <tr>
                            <td>Industrial Area</td>
                            <td>2,000</td>
                            <td>800</td>
                            <td>KSh 300</td>
                            <td>Low</td>
                            <td>8/10</td>
                        </tr>
                        <tr>
                            <td>South C/B</td>
                            <td>1,500</td>
                            <td>600</td>
                            <td>KSh 200</td>
                            <td>Medium</td>
                            <td>6/10</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 3: Competitive Landscape -->
        <div id="competition" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2>Competitive Analysis</h2>
                    <p class="section-subtitle">Market positioning and competitor assessment</p>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Market Share</th>
                            <th>Daily Volume</th>
                            <th>Avg. Price</th>
                            <th>Commission</th>
                            <th>Key Strengths</th>
                            <th>Vulnerabilities</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Glovo</strong></td>
                            <td>35%</td>
                            <td>8,750</td>
                            <td>KSh 200</td>
                            <td>25-30%</td>
                            <td>Brand recognition, Technology, Funding</td>
                            <td>High burn rate, Foreign ownership</td>
                        </tr>
                        <tr>
                            <td><strong>Uber Eats</strong></td>
                            <td>25%</td>
                            <td>6,250</td>
                            <td>KSh 250</td>
                            <td>30%</td>
                            <td>Global platform, Premium positioning</td>
                            <td>Food-focused, High prices</td>
                        </tr>
                        <tr>
                            <td><strong>Bolt Food</strong></td>
                            <td>15%</td>
                            <td>3,750</td>
                            <td>KSh 180</td>
                            <td>20%</td>
                            <td>Competitive pricing, Rapid growth</td>
                            <td>Limited coverage, New entrant</td>
                        </tr>
                        <tr>
                            <td><strong>Little</strong></td>
                            <td>10%</td>
                            <td>2,500</td>
                            <td>KSh 150</td>
                            <td>15%</td>
                            <td>Local ownership, Low prices</td>
                            <td>Limited technology, Scale constraints</td>
                        </tr>
                        <tr>
                            <td><strong>Traditional/WhatsApp</strong></td>
                            <td>15%</td>
                            <td>3,750</td>
                            <td>KSh 100-200</td>
                            <td>0%</td>
                            <td>Established relationships, Flexible</td>
                            <td>No technology, No standardization</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Competitive Response Scenarios</h2>
                    <p class="section-subtitle">Strategic responses to competitive threats</p>
                </div>

                <div class="analysis-card">
                    <h4>Scenario 1: Price War Initiated by Glovo</h4>
                    <p>Impact: 30% price reduction across market. Volume impact: -40% initially. Required capital: KSh 2M for 6-month defense. Success probability: 35% if clustering efficiency maintained above 70%.</p>
                </div>

                <div class="analysis-card">
                    <h4>Scenario 2: Uber Enters Parcel Delivery</h4>
                    <p>Impact: Premium segment competition. Volume impact: -25% in Westlands/Kilimani. Response: Focus on B2B and bulk deliveries. Required pivot time: 3 months.</p>
                </div>

                <div class="analysis-card">
                    <h4>Scenario 3: Local Competitor Copies Model</h4>
                    <p>Impact: Direct model competition. Volume impact: -15%. Defense: Leverage first-mover advantage, chairman relationships, and agent network depth.</p>
                </div>
            </div>
        </div>

        <!-- Tab 4: Unit Economics -->
        <div id="operations" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2>Unit Economics Analysis</h2>
                    <p class="section-subtitle">Real-time per-delivery economics based on current calculator settings</p>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="ueCustomerPrice">KSh 200</div>
                        <div class="metric-label">Customer Price</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="ueRiderPayment">KSh 140</div>
                        <div class="metric-label">Rider Payment (70%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="uePlatformRevenue">KSh 60</div>
                        <div class="metric-label">Platform Revenue (30%)</div>
                    </div>
                    <div class="metric-card positive">
                        <div class="metric-value" id="ueNetProfit">KSh 15.12</div>
                        <div class="metric-label">Net Profit per Delivery</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="ueContributionMargin">KSh 35</div>
                        <div class="metric-label">Contribution Margin</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="ueMarginPercent">25.2%</div>
                        <div class="metric-label">Net Margin %</div>
                    </div>
                </div>

                <div class="analysis-card">
                    <h4>Clustering Economics</h4>
                    <p id="clusteringAnalysis">With 60% clustering efficiency: Average 3-5 deliveries per route. Cost reduction: 40%. Effective delivery cost drops from KSh 140 to KSh 84 per delivery.</p>
                </div>

                <div class="analysis-card">
                    <h4>Agent Network Performance</h4>
                    <p id="agentAnalysis">Agent commission: KSh 12 per delivery. Average agent with 5 vendors (20 deliveries/vendor/month): KSh 1,200 monthly income. Top 10% agents (50+ vendors): KSh 12,000+ monthly.</p>
                </div>

                <div class="analysis-card">
                    <h4>Customer Acquisition Economics</h4>
                    <p id="cacAnalysis">Agent-based CAC: KSh 0 upfront, KSh 12 ongoing per delivery. Break-even after 42 deliveries. Traditional digital CAC: KSh 500-1,000. LTV/CAC ratio: 3.8x with 70% retention over 12 months.</p>
                </div>

                <div class="analysis-card">
                    <h4>Rider Economics</h4>
                    <p id="riderAnalysis">Average rider completes 10 deliveries/day at KSh 140 each = KSh 1,400 daily income. With clustering: 15-20 deliveries/day possible = KSh 2,100-2,800 daily.</p>
                </div>
            </div>
        </div>

        <!-- Tab 5: Cash Flow -->
        <div id="cashflow" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2>Cash Flow Projections</h2>
                    <p class="section-subtitle">Dynamic projections based on current business parameters</p>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card negative">
                        <div class="metric-value" id="cfInitialCapital">KSh 975K</div>
                        <div class="metric-label">Initial Capital Required</div>
                    </div>
                    <div class="metric-card warning">
                        <div class="metric-value" id="cfMonthlyFixed">KSh 325K</div>
                        <div class="metric-label">Monthly Fixed Costs</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="cfBreakevenMonths">3.0</div>
                        <div class="metric-label">Months to Break-even</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="cfWorkingCapital">KSh 200K</div>
                        <div class="metric-label">Working Capital Need</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="cfMpesaFloat">KSh 100K</div>
                        <div class="metric-label">M-Pesa Float Required</div>
                    </div>
                    <div class="metric-card positive">
                        <div class="metric-value" id="cfFreeCashFlow">KSh 393K</div>
                        <div class="metric-label">Monthly Free Cash Flow</div>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Delivery Ramp</th>
                            <th>Revenue</th>
                            <th>Operating Costs</th>
                            <th>Net Cash Flow</th>
                            <th>Cumulative</th>
                        </tr>
                    </thead>
                    <tbody id="cashflowTable">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>

                <div class="analysis-card">
                    <h4>Funding Requirements</h4>
                    <p id="fundingAnalysis">Based on current parameters: Initial capital of KSh 975K covers 3 months runway. Working capital of KSh 200K handles daily operations. Total funding need: KSh 1.2M for comfortable launch.</p>
                </div>
            </div>
        </div>

        <!-- Tab 6: Growth Scenarios -->
        <div id="scenarios" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2>Growth Trajectory Scenarios</h2>
                    <p class="section-subtitle">Projected growth paths based on market conditions</p>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Scenario</th>
                            <th>Timeline</th>
                            <th>Daily Deliveries</th>
                            <th>Monthly Revenue</th>
                            <th>Monthly Profit</th>
                            <th>Key Milestones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Phase 1: Launch</strong></td>
                            <td>Months 1-3</td>
                            <td>50-250</td>
                            <td>KSh 78K-390K</td>
                            <td>-KSh 247K to KSh 65K</td>
                            <td>MVP validation, First 100 customers</td>
                        </tr>
                        <tr>
                            <td><strong>Phase 2: Product-Market Fit</strong></td>
                            <td>Months 4-9</td>
                            <td>250-1,000</td>
                            <td>KSh 390K-1.56M</td>
                            <td>KSh 65K-659K</td>
                            <td>Clustering efficiency proven, 500 agents active</td>
                        </tr>
                        <tr>
                            <td><strong>Phase 3: Growth</strong></td>
                            <td>Months 10-18</td>
                            <td>1,000-3,000</td>
                            <td>KSh 1.56M-4.68M</td>
                            <td>KSh 659K-2.34M</td>
                            <td>Market leader in CBD/Eastleigh</td>
                        </tr>
                        <tr>
                            <td><strong>Phase 4: Scale</strong></td>
                            <td>Year 2+</td>
                            <td>3,000-5,000</td>
                            <td>KSh 4.68M-7.8M</td>
                            <td>KSh 2.34M-4.03M</td>
                            <td>Multi-city expansion, Strategic partnerships</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Exit Strategy Valuation</h2>
                    <p class="section-subtitle">Potential valuation based on comparable transactions</p>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">2-5x</div>
                        <div class="metric-label">Revenue Multiple</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">8-12x</div>
                        <div class="metric-label">EBITDA Multiple</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">$1.5-3M</div>
                        <div class="metric-label">Base Case Valuation</div>
                    </div>
                    <div class="metric-card positive">
                        <div class="metric-value">$3-5M</div>
                        <div class="metric-label">With Strategic Premium</div>
                    </div>
                </div>

                <div class="analysis-card">
                    <h4>Valuation Drivers</h4>
                    <p>Technology platform (40% of value), Agent network and relationships (30%), Market position and brand (20%), Operational expertise and data (10%). Strategic buyers likely to pay premium for established network and technology.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        window.tumaData = {
            revenue: {},
            costs: {},
            metrics: {}
        };

        // Tab switching
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Format currency
        function formatCurrency(num) {
            if (num >= 1000000) {
                return 'KSh ' + (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return 'KSh ' + (num / 1000).toFixed(0) + 'K';
            }
            return 'KSh ' + Math.round(num).toLocaleString();
        }

        // Main calculation function
        function updateCalculations() {
            // Get all values
            const avgPrice = parseFloat(document.getElementById('avgPrice').value);
            const platformShare = parseFloat(document.getElementById('platformShare').value) / 100;
            const dailyDeliveries = parseFloat(document.getElementById('dailyDeliveries').value);
            const expressPremium = parseFloat(document.getElementById('expressPremium').value) / 100;
            const expressPercent = parseFloat(document.getElementById('expressPercent').value) / 100;
            const workingDays = parseFloat(document.getElementById('workingDays').value);
            
            const chairmanFee = parseFloat(document.getElementById('chairmanFee').value);
            const agentCommission = parseFloat(document.getElementById('agentCommission').value) / 100;
            const techCost = parseFloat(document.getElementById('techCost').value);
            const smsCost = parseFloat(document.getElementById('smsCost').value);
            const paymentFee = parseFloat(document.getElementById('paymentFee').value) / 100;
            const taxRate = parseFloat(document.getElementById('taxRate').value) / 100;
            
            const rent = parseFloat(document.getElementById('rent').value);
            const salaries = parseFloat(document.getElementById('salaries').value);
            const marketing = parseFloat(document.getElementById('marketing').value);
            const support = parseFloat(document.getElementById('support').value);
            const insurance = parseFloat(document.getElementById('insurance').value);
            const other = parseFloat(document.getElementById('other').value);
            
            const clustering = parseFloat(document.getElementById('clustering').value) / 100;
            const failureRate = parseFloat(document.getElementById('failureRate').value) / 100;
            const retention = parseFloat(document.getElementById('retention').value) / 100;
            const distance = parseFloat(document.getElementById('distance').value);
            const utilization = parseFloat(document.getElementById('utilization').value) / 100;
            const growth = parseFloat(document.getElementById('growth').value) / 100;
            
            // Update display values
            document.getElementById('avgPriceValue').textContent = formatCurrency(avgPrice);
            document.getElementById('platformShareValue').textContent = Math.round(platformShare * 100) + '%';
            document.getElementById('dailyDeliveriesValue').textContent = dailyDeliveries.toLocaleString();
            document.getElementById('expressPremiumValue').textContent = Math.round(expressPremium * 100) + '%';
            document.getElementById('expressPercentValue').textContent = Math.round(expressPercent * 100) + '%';
            document.getElementById('workingDaysValue').textContent = workingDays;
            
            document.getElementById('chairmanFeeValue').textContent = formatCurrency(chairmanFee);
            document.getElementById('agentCommissionValue').textContent = Math.round(agentCommission * 100) + '%';
            document.getElementById('techCostValue').textContent = formatCurrency(techCost);
            document.getElementById('smsCostValue').textContent = formatCurrency(smsCost);
            document.getElementById('paymentFeeValue').textContent = (paymentFee * 100).toFixed(1) + '%';
            document.getElementById('taxRateValue').textContent = Math.round(taxRate * 100) + '%';
            
            document.getElementById('rentValue').textContent = formatCurrency(rent);
            document.getElementById('salariesValue').textContent = formatCurrency(salaries);
            document.getElementById('marketingValue').textContent = formatCurrency(marketing);
            document.getElementById('supportValue').textContent = formatCurrency(support);
            document.getElementById('insuranceValue').textContent = formatCurrency(insurance);
            document.getElementById('otherValue').textContent = formatCurrency(other);
            
            document.getElementById('clusteringValue').textContent = Math.round(clustering * 100) + '%';
            document.getElementById('failureRateValue').textContent = Math.round(failureRate * 100) + '%';
            document.getElementById('retentionValue').textContent = Math.round(retention * 100) + '%';
            document.getElementById('distanceValue').textContent = distance + ' km';
            document.getElementById('utilizationValue').textContent = Math.round(utilization * 100) + '%';
            document.getElementById('growthValue').textContent = Math.round(growth * 100) + '%';
            
            // Calculate weighted average price
            const expressPrice = avgPrice * (1 + expressPremium);
            const weightedAvgPrice = (avgPrice * (1 - expressPercent)) + (expressPrice * expressPercent);
            
            // Core calculations
            const revenuePerDelivery = weightedAvgPrice * platformShare;
            const agentCommissionPerDelivery = revenuePerDelivery * agentCommission;
            const paymentFeePerDelivery = revenuePerDelivery * paymentFee;
            const techTotalCost = techCost + smsCost;
            const variableCostPerDelivery = chairmanFee + agentCommissionPerDelivery + techTotalCost + paymentFeePerDelivery;
            
            const monthlyFixedCosts = rent + salaries + marketing + support + insurance + other;
            const dailyFixedCosts = monthlyFixedCosts / workingDays;
            const fixedCostPerDelivery = dailyFixedCosts / dailyDeliveries;
            
            const totalCostPerDelivery = variableCostPerDelivery + fixedCostPerDelivery;
            const ebitdaPerDelivery = revenuePerDelivery - totalCostPerDelivery;
            const taxPerDelivery = ebitdaPerDelivery > 0 ? ebitdaPerDelivery * taxRate : 0;
            const netProfitPerDelivery = ebitdaPerDelivery - taxPerDelivery;
            
            // Daily and monthly calculations
            const dailyRevenue = revenuePerDelivery * dailyDeliveries;
            const monthlyRevenue = dailyRevenue * workingDays;
            const annualRevenue = monthlyRevenue * 12;
            
            const dailyProfit = netProfitPerDelivery * dailyDeliveries;
            const monthlyProfit = dailyProfit * workingDays;
            const annualProfit = monthlyProfit * 12;
            
            // Break-even calculation (fixed)
            let breakEvenDeliveries = 0;
            if (revenuePerDelivery > variableCostPerDelivery) {
                const contributionMargin = revenuePerDelivery - variableCostPerDelivery;
                breakEvenDeliveries = Math.ceil(dailyFixedCosts / contributionMargin);
            }
            
            const daysToBreakEven = breakEvenDeliveries > 0 ? breakEvenDeliveries / dailyDeliveries : 0;
            
            // Other metrics
            const netMargin = (netProfitPerDelivery / revenuePerDelivery) * 100 || 0;
            const roi = monthlyFixedCosts > 0 ? (monthlyProfit / monthlyFixedCosts) * 100 : 0;
            const paybackPeriod = monthlyProfit > 0 ? (monthlyFixedCosts * 3) / monthlyProfit : 0;
            const marketShare = (dailyDeliveries / 25000) * 100;
            const ltvcac = 3.8; // Simplified
            
            // Update metrics display
            document.getElementById('revenuePerDelivery').textContent = formatCurrency(revenuePerDelivery);
            document.getElementById('grossProfitPerDelivery').textContent = formatCurrency(ebitdaPerDelivery);
            document.getElementById('netMargin').textContent = netMargin.toFixed(1) + '%';
            document.getElementById('monthlyRevenue').textContent = formatCurrency(monthlyRevenue);
            document.getElementById('monthlyProfit').textContent = formatCurrency(monthlyProfit);
            document.getElementById('annualRevenue').textContent = formatCurrency(annualRevenue);
            document.getElementById('breakEvenDeliveries').textContent = breakEvenDeliveries || 'N/A';
            document.getElementById('daysToBreakEven').textContent = daysToBreakEven > 0 ? daysToBreakEven.toFixed(1) : '< 1';
            document.getElementById('roi').textContent = roi.toFixed(0) + '%';
            document.getElementById('paybackPeriod').textContent = paybackPeriod > 0 ? paybackPeriod.toFixed(1) : 'N/A';
            document.getElementById('ltvcac').textContent = ltvcac.toFixed(1) + 'x';
            document.getElementById('marketShare').textContent = marketShare.toFixed(1) + '%';
            
            // Update table values
            document.getElementById('tblRevenuePerDelivery').textContent = formatCurrency(revenuePerDelivery);
            document.getElementById('tblRevenueDaily').textContent = formatCurrency(dailyRevenue);
            document.getElementById('tblRevenueMonthly').textContent = formatCurrency(monthlyRevenue);
            
            document.getElementById('tblChairmanPerDelivery').textContent = formatCurrency(chairmanFee);
            document.getElementById('tblChairmanDaily').textContent = formatCurrency(chairmanFee * dailyDeliveries);
            document.getElementById('tblChairmanMonthly').textContent = formatCurrency(chairmanFee * dailyDeliveries * workingDays);
            document.getElementById('tblChairmanPercent').textContent = ((chairmanFee / revenuePerDelivery) * 100).toFixed(1) + '%';
            
            document.getElementById('tblAgentPerDelivery').textContent = formatCurrency(agentCommissionPerDelivery);
            document.getElementById('tblAgentDaily').textContent = formatCurrency(agentCommissionPerDelivery * dailyDeliveries);
            document.getElementById('tblAgentMonthly').textContent = formatCurrency(agentCommissionPerDelivery * dailyDeliveries * workingDays);
            document.getElementById('tblAgentPercent').textContent = (agentCommission * 100).toFixed(1) + '%';
            
            document.getElementById('tblTechPerDelivery').textContent = formatCurrency(techTotalCost);
            document.getElementById('tblTechDaily').textContent = formatCurrency(techTotalCost * dailyDeliveries);
            document.getElementById('tblTechMonthly').textContent = formatCurrency(techTotalCost * dailyDeliveries * workingDays);
            document.getElementById('tblTechPercent').textContent = ((techTotalCost / revenuePerDelivery) * 100).toFixed(1) + '%';
            
            document.getElementById('tblPaymentPerDelivery').textContent = formatCurrency(paymentFeePerDelivery);
            document.getElementById('tblPaymentDaily').textContent = formatCurrency(paymentFeePerDelivery * dailyDeliveries);
            document.getElementById('tblPaymentMonthly').textContent = formatCurrency(paymentFeePerDelivery * dailyDeliveries * workingDays);
            document.getElementById('tblPaymentPercent').textContent = (paymentFee * 100).toFixed(1) + '%';
            
            document.getElementById('tblFixedPerDelivery').textContent = formatCurrency(fixedCostPerDelivery);
            document.getElementById('tblFixedDaily').textContent = formatCurrency(dailyFixedCosts);
            document.getElementById('tblFixedMonthly').textContent = formatCurrency(monthlyFixedCosts);
            document.getElementById('tblFixedPercent').textContent = ((fixedCostPerDelivery / revenuePerDelivery) * 100).toFixed(1) + '%';
            
            document.getElementById('tblEbitdaPerDelivery').textContent = formatCurrency(ebitdaPerDelivery);
            document.getElementById('tblEbitdaDaily').textContent = formatCurrency(ebitdaPerDelivery * dailyDeliveries);
            document.getElementById('tblEbitdaMonthly').textContent = formatCurrency(ebitdaPerDelivery * dailyDeliveries * workingDays);
            document.getElementById('tblEbitdaPercent').textContent = ((ebitdaPerDelivery / revenuePerDelivery) * 100).toFixed(1) + '%';
            
            document.getElementById('tblTaxPerDelivery').textContent = formatCurrency(taxPerDelivery);
            document.getElementById('tblTaxDaily').textContent = formatCurrency(taxPerDelivery * dailyDeliveries);
            document.getElementById('tblTaxMonthly').textContent = formatCurrency(taxPerDelivery * dailyDeliveries * workingDays);
            document.getElementById('tblTaxPercent').textContent = ((taxPerDelivery / revenuePerDelivery) * 100).toFixed(1) + '%';
            
            document.getElementById('tblNetPerDelivery').textContent = formatCurrency(netProfitPerDelivery);
            document.getElementById('tblNetDaily').textContent = formatCurrency(dailyProfit);
            document.getElementById('tblNetMonthly').textContent = formatCurrency(monthlyProfit);
            document.getElementById('tblNetPercent').textContent = ((netProfitPerDelivery / revenuePerDelivery) * 100).toFixed(1) + '%';
            
            // Update card colors based on performance
            updateMetricColors(monthlyProfit, breakEvenDeliveries, netMargin);
            
            // Update Unit Economics tab
            updateUnitEconomics(avgPrice, weightedAvgPrice, revenuePerDelivery, netProfitPerDelivery, 
                               agentCommissionPerDelivery, clustering, retention, dailyDeliveries, workingDays);
            
            // Update Cash Flow tab
            updateCashFlow(monthlyRevenue, monthlyFixedCosts, variableCostPerDelivery, 
                          dailyDeliveries, workingDays, netProfitPerDelivery);
            
            // Store globally for other tabs
            window.tumaData = {
                revenue: {
                    perDelivery: revenuePerDelivery,
                    daily: dailyRevenue,
                    monthly: monthlyRevenue,
                    annual: annualRevenue
                },
                costs: {
                    variable: variableCostPerDelivery,
                    fixed: monthlyFixedCosts,
                    total: totalCostPerDelivery
                },
                profit: {
                    gross: ebitdaPerDelivery,
                    net: netProfitPerDelivery,
                    monthly: monthlyProfit,
                    annual: annualProfit
                },
                metrics: {
                    breakEven: breakEvenDeliveries,
                    daysToBreakEven: daysToBreakEven,
                    margin: netMargin,
                    roi: roi,
                    dailyDeliveries: dailyDeliveries
                }
            };
        }

        function updateUnitEconomics(avgPrice, weightedPrice, revenue, netProfit, agentComm, clustering, retention, dailyVol, workDays) {
            // Update metric cards
            document.getElementById('ueCustomerPrice').textContent = formatCurrency(weightedPrice);
            document.getElementById('ueRiderPayment').textContent = formatCurrency(weightedPrice * 0.7);
            document.getElementById('uePlatformRevenue').textContent = formatCurrency(revenue);
            document.getElementById('ueNetProfit').textContent = formatCurrency(netProfit);
            
            const contributionMargin = revenue - (revenue * 0.2) - 10 - 3; // Revenue - agent - chairman - tech
            document.getElementById('ueContributionMargin').textContent = formatCurrency(contributionMargin);
            document.getElementById('ueMarginPercent').textContent = ((netProfit / revenue) * 100).toFixed(1) + '%';
            
            // Update analysis cards
            const clusteringText = `With ${(clustering * 100).toFixed(0)}% clustering efficiency: Average ${clustering < 0.5 ? '2-3' : clustering < 0.7 ? '3-5' : '5-8'} deliveries per route. Cost reduction: ${(clustering * 60).toFixed(0)}%. Effective delivery cost drops from KSh ${(weightedPrice * 0.7).toFixed(0)} to KSh ${(weightedPrice * 0.7 * (1 - clustering * 0.4)).toFixed(0)} per delivery.`;
            document.getElementById('clusteringAnalysis').textContent = clusteringText;
            
            const agentMonthly = agentComm * 20 * 5; // 5 vendors, 20 deliveries each
            const topAgentMonthly = agentComm * 20 * 50; // 50 vendors
            const agentText = `Agent commission: ${formatCurrency(agentComm)} per delivery. Average agent with 5 vendors (20 deliveries/vendor/month): ${formatCurrency(agentMonthly)} monthly income. Top 10% agents (50+ vendors): ${formatCurrency(topAgentMonthly)}+ monthly.`;
            document.getElementById('agentAnalysis').textContent = agentText;
            
            const breakeven = Math.ceil(500 / agentComm);
            const ltvcac = (retention * 12 * revenue * 20) / 500;
            const cacText = `Agent-based CAC: KSh 0 upfront, ${formatCurrency(agentComm)} ongoing per delivery. Break-even after ${breakeven} deliveries. Traditional digital CAC: KSh 500-1,000. LTV/CAC ratio: ${ltvcac.toFixed(1)}x with ${(retention * 100).toFixed(0)}% retention over 12 months.`;
            document.getElementById('cacAnalysis').textContent = cacText;
            
            const riderDaily = weightedPrice * 0.7 * 10;
            const riderClustered = weightedPrice * 0.7 * 15;
            const riderText = `Average rider completes 10 deliveries/day at ${formatCurrency(weightedPrice * 0.7)} each = ${formatCurrency(riderDaily)} daily income. With clustering: 15-20 deliveries/day possible = ${formatCurrency(riderClustered)}-${formatCurrency(riderClustered * 1.33)} daily.`;
            document.getElementById('riderAnalysis').textContent = riderText;
        }

        function updateCashFlow(monthlyRevenue, fixedCosts, variableCost, dailyVol, workDays, netProfit) {
            // Update metrics
            const initialCapital = fixedCosts * 3;
            document.getElementById('cfInitialCapital').textContent = formatCurrency(initialCapital);
            document.getElementById('cfMonthlyFixed').textContent = formatCurrency(fixedCosts);
            
            const breakevenMonths = fixedCosts > 0 && netProfit > 0 ? (initialCapital / (netProfit * dailyVol * workDays)).toFixed(1) : 'N/A';
            document.getElementById('cfBreakevenMonths').textContent = breakevenMonths;
            
            const workingCapital = dailyVol * 200;
            document.getElementById('cfWorkingCapital').textContent = formatCurrency(workingCapital);
            
            const mpesaFloat = dailyVol * 100;
            document.getElementById('cfMpesaFloat').textContent = formatCurrency(mpesaFloat);
            
            const freeCashFlow = netProfit * dailyVol * workDays;
            document.getElementById('cfFreeCashFlow').textContent = formatCurrency(freeCashFlow);
            
            // Update cash flow table
            const tbody = document.getElementById('cashflowTable');
            tbody.innerHTML = '';
            
            let cumulative = 0;
            const rampRates = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.25, 2.5, 2.75, 3];
            
            for (let month = 1; month <= 12; month++) {
                const ramp = rampRates[month - 1] || 3;
                const monthlyVol = Math.min(dailyVol * ramp, dailyVol * 3);
                const revenue = monthlyVol * workDays * (monthlyRevenue / (dailyVol * workDays));
                const varCosts = monthlyVol * workDays * variableCost;
                const totalCosts = varCosts + fixedCosts;
                const netCash = revenue - totalCosts;
                cumulative += netCash;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>Month ${month}</td>
                    <td>${Math.round(monthlyVol)} deliveries/day</td>
                    <td>${formatCurrency(revenue)}</td>
                    <td>${formatCurrency(totalCosts)}</td>
                    <td class="${netCash >= 0 ? '' : 'negative'}">${formatCurrency(netCash)}</td>
                    <td class="${cumulative >= 0 ? '' : 'negative'}">${formatCurrency(cumulative)}</td>
                `;
            }
            
            // Update funding analysis
            const fundingText = `Based on current parameters: Initial capital of ${formatCurrency(initialCapital)} covers 3 months runway. Working capital of ${formatCurrency(workingCapital)} handles daily operations. Total funding need: ${formatCurrency(initialCapital + workingCapital)} for comfortable launch.`;
            document.getElementById('fundingAnalysis').textContent = fundingText;
        }

        function updateMetricColors(monthlyProfit, breakEven, margin) {
            // Monthly profit color coding
            const profitCard = document.querySelector('#monthlyProfit').parentElement;
            if (monthlyProfit > 1000000) {
                profitCard.className = 'metric-card positive';
            } else if (monthlyProfit > 500000) {
                profitCard.className = 'metric-card';
            } else if (monthlyProfit > 0) {
                profitCard.className = 'metric-card warning';
            } else {
                profitCard.className = 'metric-card negative';
            }
            
            // Break-even color coding
            const breakEvenCard = document.querySelector('#breakEvenDeliveries').parentElement;
            if (breakEven < 200) {
                breakEvenCard.className = 'metric-card positive';
            } else if (breakEven < 500) {
                breakEvenCard.className = 'metric-card warning';
            } else {
                breakEvenCard.className = 'metric-card negative';
            }
            
            // Revenue cards
            const revenueCard = document.querySelector('#monthlyRevenue').parentElement;
            if (window.tumaData.revenue.monthly > 2000000) {
                revenueCard.className = 'metric-card positive';
            } else {
                revenueCard.className = 'metric-card';
            }
        }

        function loadScenario(scenario) {
            const scenarios = {
                conservative: {
                    avgPrice: 150,
                    platformShare: 25,
                    dailyDeliveries: 100,
                    chairmanFee: 15,
                    agentCommission: 25,
                    techCost: 3,
                    smsCost: 2,
                    rent: 30000,
                    salaries: 50000,
                    marketing: 20000,
                    clustering: 40,
                    failureRate: 10
                },
                moderate: {
                    avgPrice: 180,
                    platformShare: 28,
                    dailyDeliveries: 300,
                    chairmanFee: 12,
                    agentCommission: 22,
                    techCost: 2.5,
                    smsCost: 1.5,
                    rent: 40000,
                    salaries: 100000,
                    marketing: 30000,
                    clustering: 50,
                    failureRate: 7
                },
                realistic: {
                    avgPrice: 200,
                    platformShare: 30,
                    dailyDeliveries: 1000,
                    chairmanFee: 10,
                    agentCommission: 20,
                    techCost: 2,
                    smsCost: 1,
                    rent: 50000,
                    salaries: 150000,
                    marketing: 50000,
                    clustering: 60,
                    failureRate: 5
                },
                aggressive: {
                    avgPrice: 220,
                    platformShare: 32,
                    dailyDeliveries: 2000,
                    chairmanFee: 8,
                    agentCommission: 18,
                    techCost: 1.5,
                    smsCost: 0.8,
                    rent: 75000,
                    salaries: 250000,
                    marketing: 100000,
                    clustering: 70,
                    failureRate: 4
                },
                optimistic: {
                    avgPrice: 250,
                    platformShare: 35,
                    dailyDeliveries: 3000,
                    chairmanFee: 5,
                    agentCommission: 15,
                    techCost: 1,
                    smsCost: 0.5,
                    rent: 100000,
                    salaries: 400000,
                    marketing: 150000,
                    clustering: 80,
                    failureRate: 3
                }
            };
            
            const s = scenarios[scenario];
            if (s) {
                Object.keys(s).forEach(key => {
                    if (document.getElementById(key)) {
                        document.getElementById(key).value = s[key];
                    }
                });
                updateCalculations();
            }
        }

        // Save and load settings
        function saveSettings() {
            const settings = {};
            const inputs = document.querySelectorAll('.slider');
            inputs.forEach(input => {
                settings[input.id] = input.value;
            });
            localStorage.setItem('tumaSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('tumaSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                Object.keys(settings).forEach(key => {
                    if (document.getElementById(key)) {
                        document.getElementById(key).value = settings[key];
                    }
                });
            }
        }

        // Export data
        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                parameters: {},
                results: window.tumaData
            };
            
            document.querySelectorAll('.slider').forEach(input => {
                data.parameters[input.id] = input.value;
            });
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "tuma_analysis_" + Date.now() + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S to save settings
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveSettings();
            }
            
            // Ctrl/Cmd + E to export
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportData();
            }
            
            // Number keys to switch tabs
            if (e.key >= '1' && e.key <= '6') {
                const tabIndex = parseInt(e.key) - 1;
                const tabs = ['calculator', 'market', 'competition', 'operations', 'cashflow', 'scenarios'];
                if (tabs[tabIndex]) {
                    const btn = document.querySelectorAll('.tab-btn')[tabIndex];
                    if (btn) {
                        btn.click();
                    }
                }
            }
        });

        // Auto-save on change
        document.querySelectorAll('.slider').forEach(input => {
            input.addEventListener('change', saveSettings);
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            updateCalculations();
        });
    </script>
</body>
</html>
